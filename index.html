<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
    <head>
        <style>
            h3 {font-family:Arial, Helvetica, sans-serif; }
            label {font-family:Arial, Helvetica, sans-serif; color: white; }
			text {font-family:Arial, Helvetica, sans-serif; }
        </style>
    </head>
    <body style="font-family: Arial; background-color: rgb(0, 0, 0);">
        <!--<h3 style="color:white; text-align: center;">Box of springs</h3>!-->
        <div style="display: grid; grid-template-columns: 1fr 1fr;">
            <div style="grid-column: 1;">
                <div style="overflow-y: scroll; max-height: 700px;" id="controls"></div>
            </div>
            <div style="grid-column: 2;">
                <canvas id="canvas" oncontextmenu="event.preventDefault()"
                    style="touch-action: none; 
                        border: solid white 1px; top: 0px; bottom: 0px;
                        text-align: center;">
                </canvas>
                <br>
                <h3 style="color:white; font-size:14px; text-align: center;">Interactive Simulation of the Schrödinger Equation in 2D</h2>
                <p style="color:white; font-size:14px;">This interactive web program simulates 2D quantum systems by first numerically solving for the stationary states of the time-independent Schrödinger equation for arbitrary potentials, 
                    where the user can then interactively create linear combinations of these states and visualize their time evolution.
                </p>
                <p style="color:white; font-size:14px;">
                    This program is heavily inspired by <a href="https://www.falstad.com/">Paul Falstad's</a> wonderful
                    quantum mechanics <a href="https://www.falstad.com/qm2dosc/">programs</a>.
                    Numerical computations for finding the eigenstates and energies of the Hamiltonian are found using the libraries <a href="https://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> and <a href="https://spectralib.org/">Spectra</a>. Both are licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">MPL2</a>.
                </p>
                <!--<p style="color:white; font-size:14px; text-align: center;">
                Use the mouse to grab and move the box of springs around.
                </br>To reset the simulation, press the space bar.
                </p>!-->
            </div>
        </div>
    </body>
    <script type='text/javascript'>
        var canvas = document.getElementById('canvas');
        let clientW = document.documentElement.clientWidth;
        let clientH = document.documentElement.clientHeight;
        let sideLength = Number.parseInt(
            0.94*((clientW < clientH)? clientW: clientH));
        var Module = {
          canvas: canvas,
          arguments: [
            // `${Number.parseInt(clientW*0.95)}`,
            // `${Number.parseInt(clientW*0.95*(1.0/2.25))}`,
            `${Number.parseInt((9.0/5.0)*sideLength)}`,
            `${Number.parseInt((4.0/5.0)*sideLength)}`,
            `1`]
        };
        function getNormalizedCanvasCoordinates(e) {
            let x = (e.clientX - canvas.offsetLeft)/canvas.offsetWidth;
            let y = ((canvas.offsetTop + canvas.offsetHeight) 
                        - e.clientY)/canvas.offsetHeight;
            return [x, y];
        }
        document.getElementById('canvas').addEventListener('mousemove', e => {
            let [x, y] = getNormalizedCanvasCoordinates(e);
            Module.set_left_xy(x, y);
            // let strings = Module.get_strings();
            // console.log(strings);
        });
        document.getElementById('canvas').addEventListener('mouseup', e => {
            let [x, y] = getNormalizedCanvasCoordinates(e);
            let type = 0;
            Module.set_left_xy_type(x, y, 0);
        });
        document.getElementById('canvas').addEventListener('mousedown', e => {
            let [x, y] = getNormalizedCanvasCoordinates(e);
            let type = 1;
            Module.set_left_xy_type(x, y, 1);
        });

        // https://stackoverflow.com/a/47231903
        window.addEventListener("keydown", e => {
            if (e.code === "Backspace" || e.code === "Tab")
                e.stopImmediatePropagation();
        }, {capture: true});
        window.addEventListener("keyup", e => {
            if (e.code === "Backspace" || e.code === "Tab")
                e.stopImmediatePropagation();
        }, {capture: true});

        document.getElementById('setMouseInput').addEventListener(
            "change", e =>
                Module.set_mouse_mode(Number.parseInt(e.target.value))
        );
        // canvas.style.width = Number.parseInt((9.0/5.0)*sideLength);
        // canvas.style.height = Number.parseInt((4.0/5.0)*sideLength);

    </script>
    <script src="sliders.js"></script>
    <script src="main.js"></script>
</html>
